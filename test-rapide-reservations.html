<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Rapide - Filtrage Réservations</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container py-4">
      <h1 class="text-center mb-4">
        🧪 Test Rapide - Filtrage des Réservations
      </h1>

      <div class="row">
        <div class="col-md-8 mx-auto">
          <div class="alert alert-info">
            <h5>✅ Fonctionnalité Implémentée</h5>
            <p>
              <strong
                >Les clients ne voient que leurs propres réservations,
                l'administrateur voit tout !</strong
              >
            </p>
          </div>

          <div class="card mb-4">
            <div class="card-header">
              <h5>🔐 Connexion Rapide</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>👤 Clients:</h6>
                  <button
                    class="btn btn-primary btn-sm mb-2 w-100"
                    onclick="loginAs('test@email.com', '123')"
                  >
                    John Doe (2 réservations)
                  </button>
                  <button
                    class="btn btn-info btn-sm mb-2 w-100"
                    onclick="loginAs('client2@email.com', 'marie')"
                  >
                    Marie Martin (1 réservation)
                  </button>
                  <button
                    class="btn btn-warning btn-sm mb-2 w-100"
                    onclick="loginAs('client3@email.com', 'pierre')"
                  >
                    Pierre Dupont (1 réservation)
                  </button>
                </div>
                <div class="col-md-6">
                  <h6>🔧 Administrateur:</h6>
                  <button
                    class="btn btn-success btn-sm mb-2 w-100"
                    onclick="loginAs('admin@email.com', 'admin')"
                  >
                    Admin (TOUTES les réservations)
                  </button>
                  <hr />
                  <button
                    class="btn btn-secondary btn-sm w-100"
                    onclick="logout()"
                  >
                    🚪 Se déconnecter
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h5>📊 État Actuel</h5>
            </div>
            <div class="card-body">
              <div id="current-status" class="text-center">
                <span class="text-muted">Chargement...</span>
              </div>
            </div>
          </div>

          <div class="text-center mt-4">
            <a href="index.html" class="btn btn-primary btn-lg">
              🏠 Aller à l'application
            </a>
            <a
              href="guide-test-reservations.html"
              class="btn btn-outline-info btn-lg"
            >
              📖 Guide détaillé
            </a>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Simuler les fonctions du système principal
      function setCookie(name, value, days) {
        let expires = "";
        if (days) {
          const date = new Date();
          date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
          expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
      }

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
        return null;
      }

      function eraseCookie(name) {
        document.cookie =
          name + "=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
      }

      function isConnected() {
        const token = getCookie("accesstoken");
        return token !== null && token !== undefined && token !== "";
      }

      function getRole() {
        return getCookie("role");
      }

      // Fonction pour se connecter rapidement
      function loginAs(email, password) {
        const users = {
          "test@email.com": {
            password: "123",
            role: "client",
            name: "John Doe",
          },
          "admin@email.com": {
            password: "admin",
            role: "admin",
            name: "Administrateur",
          },
          "client2@email.com": {
            password: "marie",
            role: "client",
            name: "Marie Martin",
          },
          "client3@email.com": {
            password: "pierre",
            role: "client",
            name: "Pierre Dupont",
          },
        };

        const user = users[email];
        if (user && password === user.password) {
          setCookie("accesstoken", "test-token", 7);
          setCookie("role", user.role, 7);
          sessionStorage.setItem("currentUserEmail", email);

          updateStatus();
          alert(`✅ Connecté en tant que ${user.name} (${user.role})`);
        }
      }

      // Fonction pour se déconnecter
      function logout() {
        eraseCookie("accesstoken");
        eraseCookie("role");
        sessionStorage.clear();
        updateStatus();
        alert("🚪 Déconnecté avec succès");
      }

      // Mettre à jour l'affichage du statut
      function updateStatus() {
        const statusDiv = document.getElementById("current-status");
        const connected = isConnected();
        const role = getRole();
        const email = sessionStorage.getItem("currentUserEmail");

        if (!connected) {
          statusDiv.innerHTML = `
                    <div class="alert alert-secondary">
                        <h6>❌ Non connecté</h6>
                        <p class="mb-0">Cliquez sur un bouton ci-dessus pour vous connecter</p>
                    </div>
                `;
        } else {
          const roleColor = role === "admin" ? "success" : "primary";
          const roleIcon = role === "admin" ? "🔧" : "👤";

          statusDiv.innerHTML = `
                    <div class="alert alert-${roleColor}">
                        <h6>${roleIcon} Connecté en tant que ${
            role === "admin" ? "Administrateur" : "Client"
          }</h6>
                        <p class="mb-2"><strong>Email:</strong> ${email}</p>
                        <p class="mb-0">
                            <a href="index.html" class="btn btn-${roleColor} btn-sm">
                                📋 Voir les réservations
                            </a>
                        </p>
                    </div>
                `;
        }
      }

      // Initialiser au chargement
      updateStatus();

      // Mettre à jour toutes les 2 secondes
      setInterval(updateStatus, 2000);
    </script>
  </body>
</html>
